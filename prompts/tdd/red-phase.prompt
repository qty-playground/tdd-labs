# RED PHASE - Write Failing Tests

## ğŸ”´ RED PHASE ACTIVE

**ç›®æ¨™ï¼šç‚ºæ–°çš„ business rule å¯«ä¸€å€‹å¤±æ•—çš„æ¸¬è©¦**

## Strict File Modification Rules

### âœ… ALLOWED - åªèƒ½ä¿®æ”¹é€™äº›æª”æ¡ˆï¼š
- `tests/` ç›®éŒ„ä¸‹çš„ä»»ä½• `*_test.py` æª”æ¡ˆ
- æ–°å¢ test imports å’Œ test utilities
- ä¿®æ”¹ test fixtures å’Œ test data

### âŒ FORBIDDEN - çµ•å°ä¸å¯ä¿®æ”¹ï¼š
- `tdd_labs/` ç›®éŒ„ä¸‹çš„ä»»ä½•å¯¦ä½œæª”æ¡ˆ
- `main.py`, `__init__.py` ç­‰å¯¦ä½œç›¸é—œæª”æ¡ˆ  
- ä»»ä½•éæ¸¬è©¦çš„ç¨‹å¼ç¢¼

## Red Phase Objectives - CRITICAL TDD Purity Rules

### ğŸ¯ 1. ONE Test, ONE Rule - çµ•å°åŸå‰‡
**NEVER write multiple tests in one Red Phase**

âŒ **WRONG - Multiple tests:**
```python
def test_should_handle_multiples_of_three():
    assert foo_bar_bar(3) == "Foo"
    assert foo_bar_bar(6) == "Foo"  # é€™æ˜¯ç¬¬äºŒå€‹æ¸¬è©¦æ¡ˆä¾‹ï¼
    assert foo_bar_bar(9) == "Foo"  # é€™æ˜¯ç¬¬ä¸‰å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼
```

âœ… **CORRECT - Single test case:**
```python  
def test_should_return_foo_when_input_is_3():
    """åªæ¸¬è©¦ input=3 çš„æƒ…æ³ï¼Œä¸å·çœ‹æœªä¾†éœ€æ±‚"""
    assert foo_bar_bar(3) == "Foo"
```

### ğŸš« 2. NO Future Peeking - ç•¶ä¸‹æ€ç¶­
- **åªè€ƒæ…®ç•¶ä¸‹é€™ä¸€å€‹å…·é«”éœ€æ±‚**
- **ä¸è¦é æ¸¬æˆ–æº–å‚™æœªä¾†çš„æ¸¬è©¦æ¡ˆä¾‹**
- **å³ä½¿éœ€æ±‚æè¿°åŒ…å«è¤‡æ•¸ç¯„ä¾‹ï¼Œä¹ŸåªæŒ‘ä¸€å€‹ä¾†æ¸¬è©¦**

âŒ **WRONG - Peeking at future:**
```python
# éœ€æ±‚: "æ•¸å­— 3, 6, 9 éƒ½æ‡‰è©²å›å‚³ Foo"
def test_multiples_of_three():
    assert foo_bar_bar(3) == "Foo"
    assert foo_bar_bar(6) == "Foo"  # å·çœ‹æœªä¾†ï¼
    assert foo_bar_bar(9) == "Foo"  # å·çœ‹æœªä¾†ï¼
```

âœ… **CORRECT - Present focus:**
```python
# éœ€æ±‚: "æ•¸å­— 3, 6, 9 éƒ½æ‡‰è©²å›å‚³ Foo" 
# ä½†æˆ‘åªæ¸¬è©¦ç¬¬ä¸€å€‹ä¾‹å­
def test_should_return_foo_when_input_is_3():
    assert foo_bar_bar(3) == "Foo"
```

### ğŸ“ 3. Minimal Test Structure
```python
def test_should_[å…·é«”è¡Œç‚º]_when_[å…·é«”æ¢ä»¶]():
    """å…·é«”æè¿°é€™ä¸€å€‹æ¸¬è©¦è¦é©—è­‰ä»€éº¼"""
    # æœ€ç°¡å–®çš„æ¸¬è©¦ï¼Œåªé©—è­‰ä¸€å€‹æ¢ä»¶
    result = target_function(specific_input)
    assert result == expected_output
```

### 3. Expected Failure Types
```python
# Method not implemented yet
with pytest.raises(NotImplementedError):
    service.method_name()

# Class doesn't exist yet  
from tdd_labs.services.new_service import NewService  # ImportError expected

# Validation rule not implemented
with pytest.raises(ValidationError):
    service.validate("invalid_input")

# API endpoint not implemented (using test_client fixture)
def test_should_return_user_profile(test_client):
    response = test_client.get("/profile")
    # Expected: 404 or 501 - endpoint not implemented yet

# Authentication required (using authenticated_client fixture)  
def test_should_require_valid_token(authenticated_client):
    response = authenticated_client.get("/admin/users")
    # Expected: 403 or NotImplementedError - authorization logic not implemented
```

## Red Phase Completion Criteria

### âœ… Phase Complete When:
1. **Test is written** - æ–°æ¸¬è©¦å·²å¯«å®Œ
2. **Test runs and fails** - åŸ·è¡Œ `pytest -v` ç¢ºèªæ¸¬è©¦è¢«ç™¼ç¾ä¸”å¤±æ•—
3. **Test fails correctly** - æ¸¬è©¦å› ç‚ºæ­£ç¢ºçš„åŸå› å¤±æ•—ï¼ˆNotImplementedError, ImportError, etcï¼‰
4. **Test is focused** - åªæ¸¬è©¦ä¸€å€‹ business rule
5. **Imports are minimal** - åª import å¿…è¦çš„æ±è¥¿

### ğŸ“‹ Red Phase Checklist:
- [ ] æ¸¬è©¦å¯«åœ¨æ­£ç¢ºçš„ `tests/` ç›®éŒ„ä¸‹
- [ ] æ¸¬è©¦åç¨±æ¸…æ¥šæè¿° business rule
- [ ] åŸ·è¡Œ `pytest -v` ç¢ºèªæ¸¬è©¦è¢«ç™¼ç¾ä¸”æœƒå¤±æ•—ï¼ˆåŸå› æ­£ç¢ºï¼‰
- [ ] æ²’æœ‰ä¿®æ”¹ä»»ä½•å¯¦ä½œç¨‹å¼ç¢¼
- [ ] æº–å‚™å¥½é€²å…¥ Green Phase

## Transition to Green Phase

Red Phase å®Œæˆå¾Œï¼Œè¼¸å‡ºï¼š
```
ğŸ”´ â†’ ğŸŸ¢ RED PHASE COMPLETE
Failed test created: [test_method_name]
Reason for failure: [NotImplementedError/ImportError/etc]
Ready for GREEN PHASE
```

## Test Discovery Guidelines

### ç¢ºä¿æ¸¬è©¦è¢« pytest ç™¼ç¾ï¼š
```bash
# æª¢æŸ¥æ¸¬è©¦ç™¼ç¾æƒ…æ³
pytest --collect-only

# æª¢æŸ¥ç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
pytest --collect-only tests/services/user_service_test.py

# å¦‚æœæ¸¬è©¦æ²’è¢«ç™¼ç¾ï¼Œæª¢æŸ¥ï¼š
# 1. æª”æ¡ˆåç¨±æ˜¯å¦ç¬¦åˆ *_test.py æˆ– test_*.py
# 2. å‡½æ•¸åç¨±æ˜¯å¦ä»¥ test_ é–‹é ­
# 3. æª”æ¡ˆè·¯å¾‘æ˜¯å¦åœ¨ tests/ ç›®éŒ„ä¸‹
# 4. æ˜¯å¦æœ‰èªæ³•éŒ¯èª¤é˜»æ­¢ import
```

## Common Red Phase Mistakes to Avoid

âŒ **Don't**:
- ä¿®æ”¹å¯¦ä½œç¨‹å¼ç¢¼
- å¯«å¤šå€‹è¦å‰‡åœ¨ä¸€å€‹æ¸¬è©¦è£¡
- è®“æ¸¬è©¦æ„å¤–é€šé
- éåº¦è¤‡é›œçš„æ¸¬è©¦è¨­ç½®
- å¿˜è¨˜ç¢ºèªæ¸¬è©¦è¢« pytest ç™¼ç¾

âœ… **Do**:
- å°ˆæ³¨å¯«ä¸€å€‹å¤±æ•—æ¸¬è©¦
- æ¸…æ¥šè¡¨é” business rule
- ç¢ºèªå¤±æ•—åŸå› æ­£ç¢º
- ä¿æŒæ¸¬è©¦ç°¡å–®æ˜ç¢º
- å…ˆç¢ºèª test discovery æ­£å¸¸