# RED PHASE - Write Failing JUnit Tests

## ğŸ”´ RED PHASE ACTIVE (Java SE + Maven)

**ç›®æ¨™ï¼šç‚ºæ–°çš„ business rule å¯«ä¸€å€‹å¤±æ•—çš„ JUnit æ¸¬è©¦**

* å¦‚æœæ¸¬è©¦çš„æ¡ˆä¾‹æœ‰å¤šå€‹é …ç›®æ™‚ï¼Œæ‹†æˆå¤šå€‹å¾ªç’°ä¸€æ¬¡åªé€²è¡Œä¸€å€‹ã€‚ä¸ç”¨è²ªå¿ƒï¼Œä¸ç”¨è‘—æ€¥ã€‚

## Strict File Modification Rules

### âœ… ALLOWED - åªèƒ½ä¿®æ”¹é€™äº›æª”æ¡ˆï¼š
- `src/test/java/` ç›®éŒ„ä¸‹çš„ä»»ä½• `*Test.java` æª”æ¡ˆ
- æ–°å¢ test imports å’Œ test utilities
- ä¿®æ”¹ test fixtures å’Œ test data

### âŒ FORBIDDEN - çµ•å°ä¸å¯ä¿®æ”¹ï¼š
- `src/main/java/` ç›®éŒ„ä¸‹çš„ä»»ä½•å¯¦ä½œæª”æ¡ˆ
- ä»»ä½•å¯¦ä½œç›¸é—œçš„ `.java` æª”æ¡ˆ  
- ä»»ä½•éæ¸¬è©¦çš„ç¨‹å¼ç¢¼
- `pom.xml` æˆ– build é…ç½®æ–‡ä»¶ï¼ˆé™¤éæ˜ç¢ºéœ€è¦æ¸¬è©¦ä¾è³´ï¼‰

## Red Phase Objectives - CRITICAL TDD Purity Rules

### ğŸ¯ 1. ONE Test, ONE Rule - çµ•å°åŸå‰‡
**NEVER write multiple tests in one Red Phase**

âŒ **WRONG - Multiple tests:**
```java
@Test
void should_handle_multiples_of_three() {
    assertEquals("Foo", fooBarBar(3));
    assertEquals("Foo", fooBarBar(6));  // é€™æ˜¯ç¬¬äºŒå€‹æ¸¬è©¦æ¡ˆä¾‹ï¼
    assertEquals("Foo", fooBarBar(9));  // é€™æ˜¯ç¬¬ä¸‰å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼
}
```

âœ… **CORRECT - Single test case:**
```java  
@Test
void should_return_foo_when_input_is_3() {
    // åªæ¸¬è©¦ input=3 çš„æƒ…æ³ï¼Œä¸å·çœ‹æœªä¾†éœ€æ±‚
    assertEquals("Foo", fooBarBar(3));
}
```

### ğŸš« 2. NO Future Peeking - ç•¶ä¸‹æ€ç¶­
- **åªè€ƒæ…®ç•¶ä¸‹é€™ä¸€å€‹å…·é«”éœ€æ±‚**
- **ä¸è¦é æ¸¬æˆ–æº–å‚™æœªä¾†çš„æ¸¬è©¦æ¡ˆä¾‹**
- **å³ä½¿éœ€æ±‚æè¿°åŒ…å«è¤‡æ•¸ç¯„ä¾‹ï¼Œä¹ŸåªæŒ‘ä¸€å€‹ä¾†æ¸¬è©¦**

âŒ **WRONG - Peeking at future:**
```java
// éœ€æ±‚: "æ•¸å­— 3, 6, 9 éƒ½æ‡‰è©²å›å‚³ Foo"
@Test
void test_multiples_of_three() {
    assertEquals("Foo", fooBarBar(3));
    assertEquals("Foo", fooBarBar(6));  // å·çœ‹æœªä¾†ï¼
    assertEquals("Foo", fooBarBar(9));  // å·çœ‹æœªä¾†ï¼
}
```

âœ… **CORRECT - Present focus:**
```java
// éœ€æ±‚: "æ•¸å­— 3, 6, 9 éƒ½æ‡‰è©²å›å‚³ Foo" 
// ä½†æˆ‘åªæ¸¬è©¦ç¬¬ä¸€å€‹ä¾‹å­
@Test
void should_return_foo_when_input_is_3() {
    assertEquals("Foo", fooBarBar(3));
}
```

### ğŸ“ 3. Minimal Test Structure (JUnit 5)
```java
@Test
void should_[å…·é«”è¡Œç‚º]_when_[å…·é«”æ¢ä»¶]() {
    // å…·é«”æè¿°é€™ä¸€å€‹æ¸¬è©¦è¦é©—è­‰ä»€éº¼
    
    // Arrange - æº–å‚™æ¸¬è©¦æ•¸æ“š
    TargetClass target = new TargetClass();
    InputType input = specificInput;
    ExpectedType expected = expectedOutput;
    
    // Act - åŸ·è¡Œè¢«æ¸¬è©¦çš„æ–¹æ³•
    ActualType actual = target.targetMethod(input);
    
    // Assert - é©—è­‰çµæœ
    assertEquals(expected, actual);
}
```

### 4. Expected Failure Types (Java + JUnit 5)
```java
// Class doesn't exist yet - ç·¨è­¯éŒ¯èª¤
import com.example.services.NewService; // Class not found

// Method not implemented yet
@Test
void should_throw_exception_when_method_not_implemented() {
    TargetService service = new TargetService();
    assertThrows(UnsupportedOperationException.class, () -> {
        service.methodName();
    });
}

// Validation rule not implemented
@Test
void should_throw_validation_error_for_invalid_input() {
    ValidationService service = new ValidationService();
    assertThrows(ValidationException.class, () -> {
        service.validate("invalid_input");
    });
}

// Method returns null or wrong value
@Test
void should_return_correct_value() {
    CalculationService service = new CalculationService();
    // Expected: null or wrong value initially
    String result = service.process("input");
    assertEquals("expected_result", result); // Will fail
}

// Exception type mismatch
@Test
void should_handle_edge_case() {
    EdgeCaseService service = new EdgeCaseService();
    // Expected: different exception or no exception
    assertThrows(SpecificException.class, () -> {
        service.handleEdgeCase("edge_input");
    });
}
```

## Red Phase Completion Criteria

### âœ… Phase Complete When:
1. **Test is written** - æ–°çš„ JUnit æ¸¬è©¦å·²å¯«å®Œ
2. **Test runs and fails** - åŸ·è¡Œæ¸¬è©¦æŒ‡ä»¤ç¢ºèªæ¸¬è©¦è¢«ç™¼ç¾ä¸”å¤±æ•—
3. **Test fails correctly** - æ¸¬è©¦å› ç‚ºæ­£ç¢ºçš„åŸå› å¤±æ•—ï¼ˆUnsupportedOperationException, ClassNotFoundException, AssertionFailure etcï¼‰
4. **Test is focused** - åªæ¸¬è©¦ä¸€å€‹ business rule
5. **Imports are minimal** - åª import å¿…è¦çš„ classes å’Œ JUnit assertions

### ğŸ“‹ Red Phase Checklist:
- [ ] æ¸¬è©¦å¯«åœ¨æ­£ç¢ºçš„ `src/test/java/` ç›®éŒ„ä¸‹
- [ ] æ¸¬è©¦åç¨±æ¸…æ¥šæè¿° business rule
- [ ] åŸ·è¡Œæ¸¬è©¦æŒ‡ä»¤ç¢ºèªæ¸¬è©¦è¢«ç™¼ç¾ä¸”æœƒå¤±æ•—ï¼ˆåŸå› æ­£ç¢ºï¼‰
- [ ] æ²’æœ‰ä¿®æ”¹ä»»ä½• `src/main/java/` å¯¦ä½œç¨‹å¼ç¢¼
- [ ] æº–å‚™å¥½é€²å…¥ Green Phase

### ğŸ”§ å»ºè­°æ¸¬è©¦åŸ·è¡ŒæŒ‡ä»¤ï¼ˆå„ªå…ˆä½¿ç”¨ wrapperï¼‰:
```bash
# Maven - å„ªå…ˆä½¿ç”¨ wrapper
./mvnw test              # å¦‚æœæœ‰ mvnw
mvn test                 # fallback

# Gradle - å„ªå…ˆä½¿ç”¨ wrapper  
./gradlew test           # å¦‚æœæœ‰ gradlew
gradle test              # fallback
```

## Transition to Green Phase

Red Phase å®Œæˆå¾Œï¼Œè¼¸å‡ºï¼š
```
ğŸ”´ â†’ ğŸŸ¢ RED PHASE COMPLETE
Failed test created: [test_method_name]
Reason for failure: [NotImplementedError/ImportError/etc]
Ready for GREEN PHASE
```

## Test Discovery Guidelines

### ç¢ºä¿æ¸¬è©¦è¢« Maven/Gradle ç™¼ç¾ï¼š
```bash
# Maven - æª¢æŸ¥æ¸¬è©¦ç™¼ç¾æƒ…æ³ï¼ˆå„ªå…ˆä½¿ç”¨ wrapperï¼‰
./mvnw test -DdryRun=true   # å¦‚æœæœ‰ mvnw
./mvnw test --help          # æŸ¥çœ‹å¯ç”¨é¸é …
./mvnw test -Dtest=UserServiceTest  # åŸ·è¡Œç‰¹å®šæ¸¬è©¦é¡åˆ¥

# å¦‚æœæ²’æœ‰ wrapperï¼Œfallback åˆ°ï¼š
mvn test -DdryRun=true
mvn test -Dtest=UserServiceTest

# Gradle - æª¢æŸ¥æ¸¬è©¦ç™¼ç¾æƒ…æ³ï¼ˆå„ªå…ˆä½¿ç”¨ wrapperï¼‰
./gradlew test --dry-run    # å¦‚æœæœ‰ gradlew
./gradlew test --info       # é¡¯ç¤ºè©³ç´°è³‡è¨Š
./gradlew test --tests UserServiceTest  # åŸ·è¡Œç‰¹å®šæ¸¬è©¦é¡åˆ¥

# å¦‚æœæ²’æœ‰ wrapperï¼Œfallback åˆ°ï¼š
gradle test --dry-run
gradle test --tests UserServiceTest

# å¦‚æœæ¸¬è©¦æ²’è¢«ç™¼ç¾ï¼Œæª¢æŸ¥ï¼š
# 1. æª”æ¡ˆåç¨±æ˜¯å¦ç¬¦åˆ *Test.java æˆ– *Tests.java
# 2. é¡åˆ¥ä½æ–¼æ­£ç¢ºçš„ package ä¸‹
# 3. æª”æ¡ˆè·¯å¾‘æ˜¯å¦åœ¨ src/test/java/ ç›®éŒ„ä¸‹
# 4. æ˜¯å¦æœ‰ç·¨è­¯éŒ¯èª¤é˜»æ­¢åŸ·è¡Œ
# 5. æ¸¬è©¦æ–¹æ³•æ˜¯å¦æœ‰ @Test annotation
```

## Common Red Phase Mistakes to Avoid

âŒ **Don't**:
- ä¿®æ”¹ src/main/java/ ä¸‹çš„å¯¦ä½œç¨‹å¼ç¢¼
- å¯«å¤šå€‹è¦å‰‡åœ¨ä¸€å€‹æ¸¬è©¦è£¡
- è®“æ¸¬è©¦æ„å¤–é€šé
- éåº¦è¤‡é›œçš„æ¸¬è©¦ setup
- å¿˜è¨˜ç¢ºèªæ¸¬è©¦è¢« Maven/Gradle ç™¼ç¾

âœ… **Do**:
- å°ˆæ³¨å¯«ä¸€å€‹å¤±æ•—çš„ JUnit æ¸¬è©¦
- æ¸…æ¥šè¡¨é” business rule
- ç¢ºèªå¤±æ•—åŸå› æ­£ç¢ºï¼ˆcompilation error, assertion failure, exceptionï¼‰
- ä¿æŒæ¸¬è©¦ç°¡å–®æ˜ç¢º
- å…ˆç¢ºèª test discovery æ­£å¸¸ï¼ˆmvn test æˆ– gradle testï¼‰